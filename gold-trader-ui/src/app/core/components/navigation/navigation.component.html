<div class="navigation-container" [class.collapsed]="!isExpanded" #navContainer>
  <!-- Mobile toggle button -->
  <button
    class="mobile-toggle"
    (click)="toggleNavigation()"
    aria-label="Toggle navigation"
    [attr.aria-expanded]="isExpanded">
    <mat-icon>menu</mat-icon>
  </button>

  <!-- Navigation header -->
  <div class="nav-header" *ngIf="isExpanded">
    <div class="logo-container">
      <img src="assets/images/logo.svg" alt="Gold Trader Logo" class="logo">
      <span class="app-name">Gold Trader</span>
    </div>
  </div>

  <!-- Navigation items -->
  <nav id="main-navigation" class="nav-items" role="navigation" aria-label="Main navigation">
    <ul class="nav-list" role="list">
      <li *ngFor="let item of navItems" 
          class="nav-item" 
          role="listitem"
          routerLinkActive="active-parent"
          [routerLinkActiveOptions]="{exact: false}">
          
        <!-- Link for item -->
        <a [routerLink]="item.route"
           [class.has-children]="!!item.children"
           class="nav-link"
           (click)="toggleSubmenu(item, $event)"
           routerLinkActive="active"
           [routerLinkActiveOptions]="{exact: !item.children}"
           [attr.aria-current]="item.route && !item.children ? 'page' : null">
          
          <mat-icon class="nav-icon">{{item.icon}}</mat-icon>
          <span class="nav-label">{{item.label}}</span>
          <mat-icon class="expand-icon" *ngIf="item.children">
            {{ item.active ? 'expand_less' : 'expand_more' }}
          </mat-icon>
        </a>

        <!-- Submenu -->
        <ul *ngIf="item.children && item.active"
            class="submenu"
            role="group"
            [attr.aria-labelledby]="item.id">
            
          <li *ngFor="let child of item.children" class="submenu-item" role="listitem">
            <a [routerLink]="child.route"
               class="submenu-link"
               routerLinkActive="active"
               [routerLinkActiveOptions]="{exact: true}"
               [attr.aria-current]="'page'">
              
              <mat-icon class="submenu-icon">{{child.icon}}</mat-icon>
              <span class="submenu-label">{{child.label}}</span>
            </a>
          </li>
        </ul>
      </li>
    </ul>
  </nav>

  <!-- User section -->
  <div class="user-section" *ngIf="(isAuthenticated$ | async) && isExpanded">
    <div class="user-info" *ngIf="currentUser$ | async as user">
      <mat-icon>account_circle</mat-icon>
      <span class="user-name">{{ user.username }}</span>
    </div>
    <button
      class="logout-btn"
      (click)="logout()"
      aria-label="Logout">
      <mat-icon>logout</mat-icon>
      <span>Logout</span>
    </button>
  </div>
</div>